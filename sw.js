const CACHE_NAME="dicoding-story-v3",ASSETS_TO_CACHE=["/","/index.html","/manifest.json","/bundle.js","/assets/icons/icon-192x192.png","/assets/icons/icon-512x512.png"],EXTERNAL_ASSETS=["https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap","https://unpkg.com/leaflet@1.9.4/dist/leaflet.css","https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"];self.addEventListener("install",(t=>{t.waitUntil(caches.open(CACHE_NAME).then((t=>{const e=ASSETS_TO_CACHE.map((e=>t.add(e).catch((t=>{console.log(`Failed to cache ${e}:`,t)})))),n=EXTERNAL_ASSETS.map((e=>fetch(e,{mode:"no-cors"}).then((n=>{if(n.ok)return t.put(e,n)})).catch((t=>console.log(`Failed to cache ${e}:`,t)))));return Promise.all([...e,...n])})))})),self.addEventListener("activate",(t=>{t.waitUntil(caches.keys().then((t=>Promise.all(t.map((t=>{if(t!==CACHE_NAME)return caches.delete(t)}))))))})),self.addEventListener("fetch",(t=>{const{request:e}=t;new URL(e.url).pathname.startsWith("/api/")?t.respondWith(fetch(e).then((t=>{const n=t.clone();return caches.open("api-cache").then((t=>t.put(e,n))),t})).catch((()=>caches.match(e)))):t.respondWith(caches.match(e).then((t=>t||fetch(e))))})),self.addEventListener("push",(t=>{const e=t.data?.json()||{},n=e.title||"Dicoding Story";t.waitUntil(self.registration.showNotification(n,{body:e.body||"You have a new notification",icon:"/assets/icons/icon-192x192.png",badge:"/assets/icons/badge.png",data:e.data}))})),self.addEventListener("notificationclick",(t=>{t.notification.close(),t.waitUntil(clients.matchAll({type:"window"}).then((e=>{const n=t.notification.data?.url||"/";for(const t of e)if(t.url===n&&"focus"in t)return t.focus();return clients.openWindow(n)})))}));